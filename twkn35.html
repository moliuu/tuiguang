<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <style>
    .down{
      width: 90vw;
      height: 12vw;
      background: #0163FF;
      position: fixed;
      bottom: 5vh;
      left: 5vw;
      border-radius: 4vh;
      text-align: center;
      line-height: 12vw;
      color: #FFFFFF;
    }
  </style>
  <title></title>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-147216300-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-147216300-1');
</script>


</head>

<body>

  <div class="down" onclick="lc()" id="down">点击下载</div>

  <script type="text/javascript" src="//res.cdn.openinstall.io/openinstall.js" crossorigin="anonymous"></script>
  <script src="//ip.ws.126.net/ipquery"></script>
  <script>
    var _my_5cu = {
      pr: 1
    }
    if (localAddress.province.indexOf('广东') != -1) {
      _my_5cu.c = 1
    } else {
      _my_5cu.c = 2
    }
  </script>
  
  <script>
(function () {
  // 定义ajax get方法
  var Ajax = {
    get: function (url, fn) {
      // XMLHttpRequest对象用于在后台与服务器交换数据   
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.onreadystatechange = function () {
        // readyState == 4说明请求已完成
        if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
          // 从服务器获得数据 
          fn.call(this, xhr.responseText);
        }
      };
      xhr.send();
    }
  }
  // 获取url参数
  function getUParmes(name) {
    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
  }
  var channel = {
    t: '001kn_35' ,
    c: !getUParmes('c') ? 2 : getUParmes('c')
  }
  var isWeixin = /MicroMessenger/i.test(navigator.userAgent);
  var isQQ = /QQ/i.test(navigator.userAgent);
  if (isWeixin) {
    channel.pr = 1
  } else if (isQQ) {
    channel.pr = 2
  } else {
    channel.pr = 3
  }
  // 访问页面统计接口
  var url = '//install.yzapi.top/api/analysis?'
  // 页面下载按钮统计
  var downUrl = '//install.yzapi.top/api/click?'
  // t: 渠道号
  if (_my_5cu.t && _my_5cu !== '') {
    url = url + 't=' + _my_5cu.t
    downUrl = downUrl + 't=' + _my_5cu.t
  } else {
    url = url + 't=' + channel.t
    downUrl = downUrl + 't=' + channel.t
  }
  // c: 1.gd 2.hn 3.ys
  if (_my_5cu.c && _my_5cu.c !== '') {
    url = url + '&c=' + _my_5cu.c
    downUrl = downUrl + '&c=' + _my_5cu.c
  } else {
    url = url + '&c=' + channel.c
    downUrl = downUrl + '&c=' + channel.c
  }
  // pr: 推广方式
  if (_my_5cu.pr) {
    url = url + '&pr=' + _my_5cu.pr
    downUrl = downUrl + '&pr=' + _my_5cu.pr
  } else {
    url = url + '&pr=' + channel.pr
    downUrl = downUrl + '&pr=' + channel.pr
  }
  Ajax.get(url, function (res) {
    console.log('page', res)
  })
  // 下载按钮统计
  var allDownBtn = document.getElementsByClassName('downBtnClassId')
  for (var i = 0; i < allDownBtn.length; i++) {
    allDownBtn[i].addEventListener('click', function () {
      Ajax.get(downUrl, function (res) {
        console.log('down btn click', res)
      })
    })
  }
})()


    var isiPad = /iPad/i.test(navigator.userAgent);
    var isiPhone = /iPhone|iPod/i.test(navigator.userAgent);
    var isAndroid = /Android/i.test(navigator.userAgent);
    var isWeixin = /MicroMessenger/i.test(navigator.userAgent);
    var isQQ = /QQ/i.test(navigator.userAgent);
    var isIOS = (isiPad || isiPhone);
    var down_url = '';
    var t = '001kn_35'
    // var realT = rc4("php", window.atob(getUParmes('n')))
    var channel = t
    var data = {
      "channel": t
    };
    var m = new OpenInstall({
      appKey: "qmygmb"
    }, data);
    
    if (isAndroid) {
      lc()
      document.getElementById('down').style.display = 'none'
    }

    function getUParmes(name) { // 获取url参数
      return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null,
        ''
      ])[1].replace(/\+/g, '%20')) || null;
    }

    function lc() { // 下载
      if (isWeixin) {
        if (isAndroid) {
          if ((localAddress.province.indexOf('广东') != -1) && false) {
            down_url = "http://wxdg.cyol.org.cn/2019/t" + channel + "/t/"
          } else {
            down_url = "https://wxdh.cyol.org.cn/2019/" + channel + "/t/"
          }
        } else if (isIOS) {
          m.install();
        }
      } else {
        if (isAndroid) {
          if ((localAddress.province.indexOf('广东') != -1) && false) {
            down_url = "https://downg.cyol.org.cn/2019/t" + channel + "/t/"
          } else {
            down_url = "https://downh.cyol.org.cn/2019/" + channel + "/t/"
          }
        } else if (isIOS) {
          m.install();
        }
      }
      if (down_url == '') {} else {
        var os = isAndroid ? 'a' : 'i';
        window.location.href = down_url;
      };
    }
  </script>
</body>

</html>
